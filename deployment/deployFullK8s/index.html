
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://devops.pingidentity.com/deployment/deployFullK8s/">
      
      
        <link rel="prev" href="../deployLocalK8sCluster/">
      
      
        <link rel="next" href="../deployLocalOpenshift/">
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.6">
    
    
      
        <title>Deploy a robust local Kubernetes Cluster - Ping Identity DevOps</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../mkdocs/overrides/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploy-a-robust-local-kubernetes-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ping Identity DevOps" class="md-header__button md-logo" aria-label="Ping Identity DevOps" data-md-component="logo">
      <!-- Logo -->
  
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ping Identity DevOps
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deploy a robust local Kubernetes Cluster
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pingidentity/pingidentity-devops-getting-started" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pingidentity/pingidentity-devops-getting-started
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link md-tabs__link--active">
        Welcome
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../docker-images/dockerImagesRef/" class="md-tabs__link">
        Ping Docker Images
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tools/pingctlUtil/" class="md-tabs__link">
        Tools
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../how-to/devopsRegistration/" class="md-tabs__link">
        How To
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/config/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../videos/videos/" class="md-tabs__link">
        Videos
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../release-notes/currentRelease/" class="md-tabs__link">
        Release Notes
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../reference/faqs/" class="md-tabs__link">
      Customer FAQs
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../contact-us/contributing/" class="md-tabs__link">
        Contact Us
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ping Identity DevOps" class="md-nav__button md-logo" aria-label="Ping Identity DevOps" data-md-component="logo">
      <!-- Logo -->
  
    </a>
    Ping Identity DevOps
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pingidentity/pingidentity-devops-getting-started" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pingidentity/pingidentity-devops-getting-started
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Welcome
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Welcome
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          Get Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Get Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/prereqs/" class="md-nav__link">
        Prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/configVars/" class="md-nav__link">
        Environment Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/getStartedExample/" class="md-nav__link">
        Deploy Example Stack
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
          Deployment Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Deployment Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2" id="__nav_1_3_2_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployLocalK8sCluster/" class="md-nav__link">
        Create a simple local Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Create a robust local Kubernetes Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Create a robust local Kubernetes Cluster
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-machines" class="md-nav__link">
    Virtual machines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preliminary-setup" class="md-nav__link">
    Preliminary setup
  </a>
  
    <nav class="md-nav" aria-label="Preliminary setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-the-operating-system" class="md-nav__link">
    Install the Operating System
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-container-platform-containerd" class="md-nav__link">
    Install container platform (containerd)
  </a>
  
    <nav class="md-nav" aria-label="Install container platform (containerd)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#containerd-159" class="md-nav__link">
    containerd &gt; 1.5.9
  </a>
  
    <nav class="md-nav" aria-label="containerd &gt; 1.5.9">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fix-confirm-settings" class="md-nav__link">
    Fix / confirm settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes-components" class="md-nav__link">
    Install Kubernetes components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-snapshot-pre-kube-init" class="md-nav__link">
    Create snapshot 'pre-kube-init'
  </a>
  
    <nav class="md-nav" aria-label="Create snapshot 'pre-kube-init'">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-and-update-new-vms" class="md-nav__link">
    Clone and update new VMs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes" class="md-nav__link">
    Install Kubernetes
  </a>
  
    <nav class="md-nav" aria-label="Install Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove-taint-from-master" class="md-nav__link">
    Remove taint from master
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-other-nodes" class="md-nav__link">
    Add other nodes
  </a>
  
    <nav class="md-nav" aria-label="Add other nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confirm-operations-with-a-simple-deployment" class="md-nav__link">
    Confirm operations with a simple deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-install-k9s" class="md-nav__link">
    (optional) Install k9s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-snapshot-k8sinstalled" class="md-nav__link">
    Create snapshot 'k8sInstalled'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metallb" class="md-nav__link">
    MetalLB
  </a>
  
    <nav class="md-nav" aria-label="MetalLB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-operations" class="md-nav__link">
    Confirm operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-snapshot-k8smetal" class="md-nav__link">
    Create snapshot 'k8sMetal'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rook-and-ceph" class="md-nav__link">
    Rook and Ceph
  </a>
  
    <nav class="md-nav" aria-label="Rook and Ceph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confirm-requirements" class="md-nav__link">
    Confirm requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-status-of-the-storage-system" class="md-nav__link">
    Confirm status of the storage system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-storage-class" class="md-nav__link">
    Create storage class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshot-k8smetalrook" class="md-nav__link">
    Snapshot 'k8sMetalRook'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingress-controller-and-istio" class="md-nav__link">
    Ingress controller and Istio
  </a>
  
    <nav class="md-nav" aria-label="Ingress controller and Istio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ingress-nginx" class="md-nav__link">
    Ingress Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istio" class="md-nav__link">
    Istio
  </a>
  
    <nav class="md-nav" aria-label="Istio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-ons-optional" class="md-nav__link">
    Add ons (optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-optional-applications-for-access" class="md-nav__link">
    Configure Optional Applications for Access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshot-k8scomplete" class="md-nav__link">
    Snapshot 'k8sComplete'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-references" class="md-nav__link">
    Resources &amp; References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployLocalOpenshift/" class="md-nav__link">
        Create a local Openshift Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployHelm/" class="md-nav__link">
        Ping Identity Helm Charts
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2_5" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2_5" id="__nav_1_3_2_5_label" tabindex="0">
          Other Kubernetes Information
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_1_3_2_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3_2_5">
          <span class="md-nav__icon md-icon"></span>
          Other Kubernetes Information
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sClusterMetrics/" class="md-nav__link">
        Sample Monitoring Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sUtilitySidecar/" class="md-nav__link">
        Utility Sidecars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPFMultiRegion/" class="md-nav__link">
        Deploy PingFederate Across Multiple Kubernetes Clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPDMultiRegion/" class="md-nav__link">
        Deploy PingDirectory Across Multiple Kubernetes Clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPACluster/" class="md-nav__link">
        Deploy a PingAccess Cluster Without a Server Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pingDataEnvironmentConsiderations/" class="md-nav__link">
        PingData Product Considerations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploymentPatterns/" class="md-nav__link">
        Operating Patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sCloud/" class="md-nav__link">
        Cloud Kubernetes Platform Prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8s-AWS/" class="md-nav__link">
        Peered EKS Clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8s-AKS/" class="md-nav__link">
        Azure Kubernetes Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8sClusterSizing/" class="md-nav__link">
        Sizing Kubernetes Clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployHelmLocalIngress/" class="md-nav__link">
        Ingress on local Kind Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../restorePDMultiRegionSeedFailure/" class="md-nav__link">
        Restoring a Multi Region PingDirectory Deployment on Seed Region Failure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3_3" id="__nav_1_3_3_label" tabindex="0">
          Docker Compose
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3_3">
          <span class="md-nav__icon md-icon"></span>
          Docker Compose
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployCompose/" class="md-nav__link">
        Single Product Deployments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../home/supportPolicy/" class="md-nav__link">
        Support Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../home/license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../home/disclaimer/" class="md-nav__link">
        Disclaimer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../home/3rdPartySoftware/" class="md-nav__link">
        Third-Party Software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../home/portalUpdates/" class="md-nav__link">
        Portal updates
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Ping Docker Images
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Ping Docker Images
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/dockerImagesRef/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Product Images
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Product Images
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingaccess/" class="md-nav__link">
        PingAccess
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingauthorize/" class="md-nav__link">
        PingAuthorize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingauthorizepap/" class="md-nav__link">
        PingAuthorize PAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingbase/" class="md-nav__link">
        PingBase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingcentral/" class="md-nav__link">
        PingCentral
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingcommon/" class="md-nav__link">
        PingCommon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdatacommon/" class="md-nav__link">
        PingDataCommon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdataconsole/" class="md-nav__link">
        PingDataConsole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdatasync/" class="md-nav__link">
        PingDataSync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdelegator/" class="md-nav__link">
        PingDelegator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdirectory/" class="md-nav__link">
        PingDirectory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdirectoryproxy/" class="md-nav__link">
        PingDirectoryProxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingfederate/" class="md-nav__link">
        PingFederate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingintelligence/" class="md-nav__link">
        PingIntelligence
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Other Images
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Other Images
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingtoolkit/" class="md-nav__link">
        PingToolkit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/apache-jmeter/" class="md-nav__link">
        Apache JMeter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/ldap-sdk-tools/" class="md-nav__link">
        ldap-sdk-tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          Image Details
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Image Details
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/releaseTags/" class="md-nav__link">
        Release Tags
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/productVersionMatrix/" class="md-nav__link">
        Product & Image Release Matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/dockerImageSecurity/" class="md-nav__link">
        DevOps Image Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/imageSupport/" class="md-nav__link">
        Docker Image Support Policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/pingctlUtil/" class="md-nav__link">
        pingctl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/ldapsdkUtil/" class="md-nav__link">
        ldap-sdk-tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/pingDevopsUtil_Deprecated/" class="md-nav__link">
        ping-devops utility (deprecated)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/pingDownloader_Deprecated/" class="md-nav__link">
        PingDownloader Image (deprecated)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          How To
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          How To
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/devopsRegistration/" class="md-nav__link">
        DevOps Registration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/existingLicense/" class="md-nav__link">
        Use Existing Licenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Server Profile
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Server Profile
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/containerAnatomy/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profiles/" class="md-nav__link">
        Customization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/saveConfigs/" class="md-nav__link">
        Saving Configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3_4" id="__nav_4_3_4_label" tabindex="0">
          Build Your Own
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3_4">
          <span class="md-nav__icon md-icon"></span>
          Build Your Own
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/buildPingFederateProfile/" class="md-nav__link">
        PingFederate Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/buildPingDirectoryProfile/" class="md-nav__link">
        PingDirectory Profile
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profilesLayered/" class="md-nav__link">
        Layering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profilesSubstitution/" class="md-nav__link">
        ENV Substitution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profilesPingDataExtensions/" class="md-nav__link">
        Installing Extensions with PingData Profiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/privateRepos/" class="md-nav__link">
        Private Github Repos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/usingVault/" class="md-nav__link">
        Vault/Secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/secureContainers/" class="md-nav__link">
        Securing the Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
      
      
      
        <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
          Upgrading Deployments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          Upgrading Deployments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/manage/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/upgradePingAccess/" class="md-nav__link">
        Upgrading PingAccess
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/upgradePingfederate/" class="md-nav__link">
        Upgrading PingFederate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/upgradePingDirectory/" class="md-nav__link">
        Upgrading PingDirectory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/migratingRootToUnprivileged/" class="md-nav__link">
        Migrating to Unprivileged Images
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/assignPFNodeId/" class="md-nav__link">
        Set PingFederate Provisioner Node ID
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/addMOTD/" class="md-nav__link">
        Adding a MOTD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/buildLocal/" class="md-nav__link">
        Build Local Product Image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/splunkLogging/" class="md-nav__link">
        Forward Logs to Splunk
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/config/" class="md-nav__link">
        Components and Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/profileStructures/" class="md-nav__link">
        Server Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/variableScoping/" class="md-nav__link">
        Variables and Scope
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/usingCertificates/" class="md-nav__link">
        Certificates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/hooks/" class="md-nav__link">
        DevOps Hook Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/k8sBasics/" class="md-nav__link">
        Kubernetes Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/HelmBasics/" class="md-nav__link">
        Helm Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/containerLogging/" class="md-nav__link">
        Container Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
      
      
      
        <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
          Deprecated
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_10">
          <span class="md-nav__icon md-icon"></span>
          Deprecated
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/yamlFiles/" class="md-nav__link">
        Docker Compose YAML
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Videos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Videos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../videos/videos/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Release Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/currentRelease/" class="md-nav__link">
        Current Release
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          All Releases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          All Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2303/" class="md-nav__link">
        Version 2303
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2302/" class="md-nav__link">
        Version 2302
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2301/" class="md-nav__link">
        Version 2301
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2212/" class="md-nav__link">
        Version 2212
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2211/" class="md-nav__link">
        Version 2211
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2210/" class="md-nav__link">
        Version 2210
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2209/" class="md-nav__link">
        Version 2209
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2208/" class="md-nav__link">
        Version 2208
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2207/" class="md-nav__link">
        Version 2207
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2206/" class="md-nav__link">
        Version 2206
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2205/" class="md-nav__link">
        Version 2205
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2204/" class="md-nav__link">
        Version 2204
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2203/" class="md-nav__link">
        Version 2203
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2202/" class="md-nav__link">
        Version 2202
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2201/" class="md-nav__link">
        Version 2201
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2112/" class="md-nav__link">
        Version 2112
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2111-1/" class="md-nav__link">
        Version 2111.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2111/" class="md-nav__link">
        Version 2111
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2110/" class="md-nav__link">
        Version 2110
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2109/" class="md-nav__link">
        Version 2109
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2108/" class="md-nav__link">
        Version 2108
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2107/" class="md-nav__link">
        Version 2107
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2106/" class="md-nav__link">
        Version 2106
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2105/" class="md-nav__link">
        Version 2105
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2104/" class="md-nav__link">
        Version 2104
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2103/" class="md-nav__link">
        Version 2103
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2102/" class="md-nav__link">
        Version 2102
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2101/" class="md-nav__link">
        Version 2101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2012/" class="md-nav__link">
        Version 2012
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2011/" class="md-nav__link">
        Version 2011
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2010/" class="md-nav__link">
        Version 2010
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2009/" class="md-nav__link">
        Version 2009
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2008/" class="md-nav__link">
        Version 2008
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2007/" class="md-nav__link">
        Version 2007
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2006/" class="md-nav__link">
        Version 2006
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2005/" class="md-nav__link">
        Version 2005
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2004/" class="md-nav__link">
        Version 2004
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2003/" class="md-nav__link">
        Version 2003
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../reference/faqs/" class="md-nav__link">
        Customer FAQs
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Contact Us
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Contact Us
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contact-us/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contact-us/community/" class="md-nav__link">
        Community
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-machines" class="md-nav__link">
    Virtual machines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preliminary-setup" class="md-nav__link">
    Preliminary setup
  </a>
  
    <nav class="md-nav" aria-label="Preliminary setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-the-operating-system" class="md-nav__link">
    Install the Operating System
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-container-platform-containerd" class="md-nav__link">
    Install container platform (containerd)
  </a>
  
    <nav class="md-nav" aria-label="Install container platform (containerd)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#containerd-159" class="md-nav__link">
    containerd &gt; 1.5.9
  </a>
  
    <nav class="md-nav" aria-label="containerd &gt; 1.5.9">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fix-confirm-settings" class="md-nav__link">
    Fix / confirm settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes-components" class="md-nav__link">
    Install Kubernetes components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-snapshot-pre-kube-init" class="md-nav__link">
    Create snapshot 'pre-kube-init'
  </a>
  
    <nav class="md-nav" aria-label="Create snapshot 'pre-kube-init'">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-and-update-new-vms" class="md-nav__link">
    Clone and update new VMs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes" class="md-nav__link">
    Install Kubernetes
  </a>
  
    <nav class="md-nav" aria-label="Install Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove-taint-from-master" class="md-nav__link">
    Remove taint from master
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-other-nodes" class="md-nav__link">
    Add other nodes
  </a>
  
    <nav class="md-nav" aria-label="Add other nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confirm-operations-with-a-simple-deployment" class="md-nav__link">
    Confirm operations with a simple deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-install-k9s" class="md-nav__link">
    (optional) Install k9s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-snapshot-k8sinstalled" class="md-nav__link">
    Create snapshot 'k8sInstalled'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metallb" class="md-nav__link">
    MetalLB
  </a>
  
    <nav class="md-nav" aria-label="MetalLB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-operations" class="md-nav__link">
    Confirm operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-snapshot-k8smetal" class="md-nav__link">
    Create snapshot 'k8sMetal'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rook-and-ceph" class="md-nav__link">
    Rook and Ceph
  </a>
  
    <nav class="md-nav" aria-label="Rook and Ceph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confirm-requirements" class="md-nav__link">
    Confirm requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confirm-status-of-the-storage-system" class="md-nav__link">
    Confirm status of the storage system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-storage-class" class="md-nav__link">
    Create storage class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshot-k8smetalrook" class="md-nav__link">
    Snapshot 'k8sMetalRook'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingress-controller-and-istio" class="md-nav__link">
    Ingress controller and Istio
  </a>
  
    <nav class="md-nav" aria-label="Ingress controller and Istio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ingress-nginx" class="md-nav__link">
    Ingress Nginx
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istio" class="md-nav__link">
    Istio
  </a>
  
    <nav class="md-nav" aria-label="Istio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-ons-optional" class="md-nav__link">
    Add ons (optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-optional-applications-for-access" class="md-nav__link">
    Configure Optional Applications for Access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snapshot-k8scomplete" class="md-nav__link">
    Snapshot 'k8sComplete'
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-references" class="md-nav__link">
    Resources &amp; References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="deploy-a-robust-local-kubernetes-cluster">Deploy a robust local Kubernetes Cluster<a class="headerlink" href="#deploy-a-robust-local-kubernetes-cluster" title="Permanent link"> ¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Video Demonstration</p>
<p>A video demonstrating the process outlined on this page is available <a href="https://videos.pingidentity.com/detail/videos/devops/video/6324019967112/robust-test-kubernetes-cluster">here</a>.</p>
</div>
<p>In some cases, a single-node cluster is insufficient for more complex testing scenarios.  If you do not have access to a managed Kubernetes cluster and want something more similar to what you would find in a production environment, this guide can help.</p>
<p>This document describes deploying a multi-node cluster using the <a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm//">kubeadm</a> utility, running under virtual machines. When completed, the cluster will consist of:</p>
<ul>
<li>3 nodes, a master with two worker nodes (to conserve resources, the master will also be configured to run workloads)</li>
<li>Kubernetes 1.26.2 using the <strong>containerd</strong> runtime (no Docker installed)</li>
<li>Load balancer</li>
<li>Block storage support for PVC/PV needed by some Ping products</li>
<li>(Optional) Ingress controller</li>
<li>(Optional) Istio service mesh</li>
<li>(Optional) supplementary tools for tracing and monitoring</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Demo Use Only</p>
<p>While the result is a full Kubernetes installation, the instructions in this document only create an environment sufficient for testing and learning.  The cluster is not intended for use in production environments.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Manual process</p>
<p>At this time, work is underway to automate many, if not all of these steps. In the meantime, you will know more about how the cluster is configured and set up by following this guide.</p>
</div>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link"> ¶</a></h2>
<p>In order to complete this guide, you will need:</p>
<ul>
<li>64 GB of RAM (32 GB might be enough if you have an SSD to handle some memory swapping and reduce the RAM on the VMs to 12 GB)</li>
<li>At least 150 GB of free disk</li>
<li>Modern processor with multiple cores</li>
<li>Virtualization solution.  For this guide, VMware Fusion is used, but other means of creating and running a VM (Virtualbox, KVM) can be adapted.</li>
<li>Access to <a href="https://ubuntu.com/download/server">Ubuntu LTS 22.04.2 server</a> installation media</li>
<li><strong>A working knowledge of Kubernetes</strong>, such as knowing how to port-forward, install objects using YAML files, and so on. Details on performing some actions will be omitted, and it is assumed the reader will know what to do.</li>
<li>Patience</li>
</ul>
<h2 id="virtual-machines">Virtual machines<a class="headerlink" href="#virtual-machines" title="Permanent link"> ¶</a></h2>
<p>Create 3 VMs were created as described here.  The worker nodes are created by cloning a snapshot of the master after preliminary configuration is performed.  To begin, you will only create the master node. If cloning is not an option, you will need to perform all steps up to the <code>kubeadm init</code> command on all three VMs, configuring them in an identical fashion to each other except for hostname and IP.</p>
<ul>
<li>4 vCPU</li>
<li>16 GB RAM</li>
<li>2 disks: 80 GB disk for the primary / 60 GB as secondary</li>
<li>Attached to a network that allows internet access (bridged or NAT), using a fixed IP address</li>
</ul>
<div class="admonition info">
<p class="admonition-title">IP Space</p>
<p>192.168.163.0/24 was the IP space used in this guide; adjust to your environment accordingly.</p>
</div>
<table>
<thead>
<tr>
<th>VM</th>
<th>Hostname</th>
<th>IP address</th>
</tr>
</thead>
<tbody>
<tr>
<td>Master node</td>
<td>k8s126master</td>
<td>192.168.163.40</td>
</tr>
<tr>
<td>Worker</td>
<td>k8s126node01</td>
<td>192.168.163.41</td>
</tr>
<tr>
<td>Worker</td>
<td>k8s126node02</td>
<td>192.168.163.42</td>
</tr>
</tbody>
</table>
<h2 id="preliminary-setup">Preliminary setup<a class="headerlink" href="#preliminary-setup" title="Permanent link"> ¶</a></h2>
<p>Perform these actions on the master node VM.</p>
<h3 id="install-the-operating-system">Install the Operating System<a class="headerlink" href="#install-the-operating-system" title="Permanent link"> ¶</a></h3>
<p>Install the operating system as default, using the first disk (80 GB) as the installation target.  For this guide, the installation disk was formatted to use the entire disk as the root partition, without LVM support.</p>
<p>After installation and reboot, upgrade all packages to the latest and perform the basic configuration needed:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Upgrade all packages</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y

<span class="c1"># Modify the /etc/hosts file, adding these entries</span>
<span class="c1"># Adjust the IP addresses accordingly</span>
<span class="m">192</span>.168.163.40<span class="w"> </span>k8smaster
<span class="m">192</span>.168.163.41<span class="w"> </span>k8snode01
<span class="m">192</span>.168.163.42<span class="w"> </span>k8snode02

<span class="c1"># Load the overlay and br_netfilter kernel modules</span>
sudo<span class="w"> </span>modprobe<span class="w"> </span>overlay
sudo<span class="w"> </span>modprobe<span class="w"> </span>br_netfilter

<span class="c1"># Configure the system to load the kernel modules at each boot</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span>
<span class="s">br_netfilter</span>
<span class="s">overlay</span>
<span class="s">EOF</span>

<span class="c1"># Enable IP forwarding for iptables</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span>
<span class="s">net.bridge.bridge-nf-call-iptables  = 1</span>
<span class="s">net.ipv4.ip_forward                 = 1</span>
<span class="s">net.bridge.bridge-nf-call-ip6tables = 1</span>
<span class="s">EOF</span>

<span class="c1"># Apply sysctl params without reboot</span>
sudo<span class="w"> </span>sysctl<span class="w"> </span>--system

<span class="c1"># Disable swap</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;/swap/s/^\(.*\)$/#\1/g&#39;</span><span class="w"> </span>/etc/fstab
</code></pre></div>
<h2 id="install-container-platform-containerd">Install container platform (containerd)<a class="headerlink" href="#install-container-platform-containerd" title="Permanent link"> ¶</a></h2>
<p>At this point, you will install the <strong>containerd</strong> runtime.</p>
<h3 id="containerd-159">containerd &gt; 1.5.9<a class="headerlink" href="#containerd-159" title="Permanent link"> ¶</a></h3>
<p>Kubernetes 1.26+ requires <code>containerd</code> runtime &gt;= 1.6. The default installation from the Ubuntu repositories installs version 1.5.9.  The solution in this guide is to use the Docker repository for the installation of these packages.  At the time of this writing, 1.6.18-1 is installed in this manner.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Install and configure containerd</span>
<span class="c1"># Add the Docker repository for Ubuntu</span>
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>-y<span class="w"> </span><span class="s2">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span>-y

<span class="c1"># Install containerd</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>containerd.io
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/containerd

<span class="c1"># Generate a default configuration</span>
containerd<span class="w"> </span>config<span class="w"> </span>default<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/containerd/config.toml

<span class="c1"># Start containerd</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>containerd
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>containerd
</code></pre></div>
<h4 id="fix-confirm-settings">Fix / confirm settings<a class="headerlink" href="#fix-confirm-settings" title="Permanent link"> ¶</a></h4>
<p>In order for the <strong>etcd</strong> pod to remain stable, the <code>SystemdCgroup</code> flag for the runc options must be set to true.  The default configuration sets this boolean to false.</p>
<p>Modify <strong>/etc/containerd/config.toml</strong>.   The <code>runtime_type</code> is probably correct, but the <code>SystemdCgroup</code> default was <strong>false</strong>.  The two values to confirm or modify were at lines 112 and 125 at the time of this writing.</p>
<div class="highlight"><pre><span></span><code>version = 2
  [plugins]
    [plugins.&quot;io.containerd.grpc.v1.cri&quot;]
      [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd]
        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes]
          [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc]
          runtime_type = &quot;io.containerd.runc.v2&quot;  &lt;-- confirm or modify
            [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
            SystemdCgroup = true  &lt;-- confirm or modify
</code></pre></div>
<p>Restart containerd: <code>sudo systemctl restart containerd</code></p>
<h2 id="install-kubernetes-components">Install Kubernetes components<a class="headerlink" href="#install-kubernetes-components" title="Permanent link"> ¶</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Install prerequisites</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-y
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>software-properties-common<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>bzip2<span class="w"> </span>tar<span class="w"> </span>vim<span class="w"> </span>git<span class="w"> </span>wget<span class="w"> </span>net-tools<span class="w"> </span>lvm2

<span class="c1"># Get the key and add the Kubernetes repository</span>
sudo<span class="w"> </span>curl<span class="w"> </span>-fsSLo<span class="w"> </span>/usr/share/keyrings/kubernetes-archive-keyring.gpg<span class="w"> </span>https://packages.cloud.google.com/apt/doc/apt-key.gpg
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list

sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-y
<span class="c1"># Install latest (1.26.2)</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl

<span class="c1">################################################</span>
<span class="c1">##### Optional to install specific version #####</span>
<span class="c1">################################################</span>
<span class="c1"># determine version available</span>
<span class="c1"># curl -s https://packages.cloud.google.com/apt/dists/kubernetes-xenial/main/binary-amd64/Packages | grep Version | awk &#39;{print $2}&#39;</span>
<span class="c1"># install version from list generated by previous command, for example:</span>
<span class="c1"># sudo apt-get install -y kubelet=1.24.9-00 kubectl=1.24.9-00 kubeadm=1.24.9-00</span>
<span class="c1">################################################</span>
<span class="c1">#####        end optional section          #####</span>
<span class="c1">################################################</span>

<span class="c1"># Lock K8s version</span>
sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
</code></pre></div>
<h2 id="create-snapshot-pre-kube-init">Create snapshot 'pre-kube-init'<a class="headerlink" href="#create-snapshot-pre-kube-init" title="Permanent link"> ¶</a></h2>
<p>Halt the VM by running <code>sudo shutdown -h now</code>.</p>
<p>Create a snapshot of the VM, naming it <strong>pre-kube-init</strong>. This snapshot provides a rollback point in case the installation of Kubernetes fails.  You will use snapshots at several other key points for the same purpose. After installation is compete, these intermediate snapshots can be removed.</p>
<h3 id="clone-and-update-new-vms">Clone and update new VMs<a class="headerlink" href="#clone-and-update-new-vms" title="Permanent link"> ¶</a></h3>
<p>From the <strong>pre-kube-init</strong> snapshot on the master, create a full clone to serve as a worker node, naming it accordingly.</p>
<p>When the clone is complete, perform the following actions:</p>
<ul>
<li>Regenerate the mac address on the network adapter and start up the new VM</li>
<li>Update the network IP address by modifying <strong>/etc/netplan/00-installer-config.yaml</strong></li>
<li>Regenerate the SSH key:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/bin/rm<span class="w"> </span>-v<span class="w"> </span>/etc/ssh/ssh_host_*
sudo<span class="w"> </span>dpkg-reconfigure<span class="w"> </span>openssh-server
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>ssh
</code></pre></div>
<ul>
<li>Update the hostname by running<code>sudo hostnamectl set-hostname &lt;newname&gt;</code></li>
<li>Update line 2 of <strong>/etc/hosts</strong> to match the new hostname</li>
<li>Shutdown &amp; snapshot with same snapshot name (<strong>pre-kube-init</strong>) as the master</li>
</ul>
<p>Repeat for the second worker node.</p>
<h2 id="install-kubernetes">Install Kubernetes<a class="headerlink" href="#install-kubernetes" title="Permanent link"> ¶</a></h2>
<p>Boot all three VMs.</p>
<p><strong>On the master only</strong>, run <code>kubeadm init</code>.  </p>
<div class="admonition error">
<p class="admonition-title">IP address</p>
<p>Adjust the IP address accordingly for the <code>apiserver-advertise-address</code> and <code>control-plane-endpoint</code>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># On the master node only</span>
<span class="c1"># Pod CIDR is default for flannel</span>
sudo<span class="w"> </span>kubeadm<span class="w"> </span>init<span class="w"> </span>--pod-network-cidr<span class="o">=</span><span class="m">10</span>.244.0.0/16<span class="w"> </span>--upload-certs<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--apiserver-advertise-address<span class="o">=</span><span class="m">192</span>.168.163.40<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--control-plane-endpoint<span class="o">=</span><span class="m">192</span>.168.163.40<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--cri-socket<span class="w"> </span>unix:///run/containerd/containerd.sock

<span class="c1"># When finished, copy off the join command from the output for use on the other nodes</span>
<span class="c1"># Configure kubectl for the non-root user</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$HOME</span>/.kube
sudo<span class="w"> </span>cp<span class="w"> </span>-i<span class="w"> </span>/etc/kubernetes/admin.conf<span class="w"> </span><span class="nv">$HOME</span>/.kube/config
sudo<span class="w"> </span>chown<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="nv">$HOME</span>/.kube/config

<span class="c1"># Install CNI (flannel in this example)</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
</code></pre></div>
<details>
  <summary>Sample output of the installation</summary>

<div class="highlight"><pre><span></span><code># Sample output from init
[init] Using Kubernetes version: v1.26.2
[preflight] Running pre-flight checks
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
[certs] Generating &quot;ca&quot; certificate and key
[certs] Generating &quot;apiserver&quot; certificate and key
[certs] apiserver serving cert is signed for DNS names [k8s126master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.163.40]
[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
[certs] Generating &quot;front-proxy-ca&quot; certificate and key
[certs] Generating &quot;front-proxy-client&quot; certificate and key
[certs] Generating &quot;etcd/ca&quot; certificate and key
[certs] Generating &quot;etcd/server&quot; certificate and key
[certs] etcd/server serving cert is signed for DNS names [k8s126master localhost] and IPs [192.168.163.40 127.0.0.1 ::1]
[certs] Generating &quot;etcd/peer&quot; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [k8s126master localhost] and IPs [192.168.163.40 127.0.0.1 ::1]
[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
[certs] Generating &quot;sa&quot; key and public key
[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Starting the kubelet
[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 10.001720 seconds
[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace
[upload-certs] Using certificate key:
f5050f09f6fc60d3f8701b21bee71855f4c55e76b82aacd264afcf90191dc304
[mark-control-plane] Marking the node k8s126master as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
[mark-control-plane] Marking the node k8s126master as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]
[bootstrap-token] Using token: 7wc3xe.yt76msej78s4mtb9
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes
[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of the control-plane node running the following command on each as root:

  kubeadm join 192.168.163.40:6443 --token 7wc3xe.yt76msej78s4mtb9 \
 --discovery-token-ca-cert-hash sha256:d22f7753d0c5b28fe386e13fa57cc47a0e261e23cc98aa13b9316645dddefe56 \
 --control-plane --certificate-key f5050f09f6fc60d3f8701b21bee71855f4c55e76b82aacd264afcf90191dc304

Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use
&quot;kubeadm init phase upload-certs --upload-certs&quot; to reload certs afterward.

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.163.40:6443 --token 7wc3xe.yt76msej78s4mtb9 \
 --discovery-token-ca-cert-hash sha256:d22f7753d0c5b28fe386e13fa57cc47a0e261e23cc98aa13b9316645dddefe56
</code></pre></div>

</details>

<h3 id="remove-taint-from-master">Remove taint from master<a class="headerlink" href="#remove-taint-from-master" title="Permanent link"> ¶</a></h3>
<p>Removing the <strong><em>NoSchedule</em></strong> taint will allow workloads to run on the master node:</p>
<p><code>kubectl taint nodes --all node-role.kubernetes.io/control-plane:NoSchedule-</code></p>
<h3 id="add-other-nodes">Add other nodes<a class="headerlink" href="#add-other-nodes" title="Permanent link"> ¶</a></h3>
<p>On the worker nodes, run the join command as indicated in the output of the installation on the master.  You can confirm that all nodes are working by running <code>kubectl get nodes</code> on the master.</p>
<h4 id="confirm-operations-with-a-simple-deployment">Confirm operations with a simple deployment<a class="headerlink" href="#confirm-operations-with-a-simple-deployment" title="Permanent link"> ¶</a></h4>
<p>Create a file named <em>nginx-deploy.yaml</em> with these contents:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># tells deployment to run 2 pods matching the template</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.14.2</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
<p>Apply the file to create the objects:  <code>kubectl apply -f nginx-deploy.yaml</code>  You should see the nginx deployment with 2 pods.</p>
<p>After confirming, remove it: <code>kubectl delete -f nginx-deploy.yaml</code></p>
<h3 id="optional-install-k9s">(optional) Install k9s<a class="headerlink" href="#optional-install-k9s" title="Permanent link"> ¶</a></h3>
<p>If you want the <a href="https://github.com/derailed/k9s">k9s</a> utility, follow these steps.  Run these commands only on the master.</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://github.com/derailed/k9s/releases/download/v0.27.2/k9s_Linux_amd64.tar.gz
wget<span class="w"> </span>https://github.com/derailed/k9s/releases/download/v0.27.2/checksums.txt

<span class="c1"># This command should return OK for the one file we downloaded; ignore other output</span>
sha256sum<span class="w"> </span>-c<span class="w"> </span>checksums.txt

<span class="c1"># Extract to /usr/local/bin</span>
sudo<span class="w"> </span>tar<span class="w"> </span>Cxzvf<span class="w"> </span>/usr/local/bin<span class="w"> </span>k9s_Linux_amd64.tar.gz
</code></pre></div>
<h2 id="create-snapshot-k8sinstalled">Create snapshot 'k8sInstalled'<a class="headerlink" href="#create-snapshot-k8sinstalled" title="Permanent link"> ¶</a></h2>
<p>Shutdown the VMs, and snapshot each one.  See the helper script in this repository located at <code>99-helper-scripts/manageCluster.sh</code> that can be used for automating things under VMware.</p>
<h2 id="metallb">MetalLB<a class="headerlink" href="#metallb" title="Permanent link"> ¶</a></h2>
<p>A bare metal installation of Kubernetes does not provide a load balancer, which makes simulating some actions difficult.  In this section, you will install and configure the MetalLB load balancer.</p>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link"> ¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get latest tag</span>
<span class="nv">MetalLB_RTAG</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.github.com/repos/metallb/metallb/releases/latest<span class="w"> </span><span class="se">\</span>
<span class="p">|</span>grep<span class="w"> </span>tag_name<span class="w"> </span><span class="se">\</span>
<span class="p">|</span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;&quot;&#39;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">4</span><span class="p">|</span>sed<span class="w"> </span><span class="s1">&#39;s/v//&#39;</span><span class="k">)</span>

<span class="c1"># Confirm version</span>
<span class="nb">echo</span><span class="w"> </span><span class="nv">$MetalLB_RTAG</span>

<span class="c1"># Grab and apply the native definition</span>
mkdir<span class="w"> </span>~/metal<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/metal
wget<span class="w"> </span>https://raw.githubusercontent.com/metallb/metallb/v<span class="nv">$MetalLB_RTAG</span>/config/manifests/metallb-native.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb-native.yaml
</code></pre></div>
<p>Create an IP pool that corresponds to the IP space in your environment.  Line 8 of the file will vary depending on your IP space:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ipaddress_pool_metal.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPAddressPool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">addresses</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.163.151-192.168.163.250</span>

<span class="nn">---</span>

<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2Advertisement</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l2-advert</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</code></pre></div>
<p>Apply the file to create the pool:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Apply the file</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>ipaddress_pool_metal.yaml

ipaddresspool.metallb.io/production<span class="w"> </span>created
l2advertisement.metallb.io/l2-advert<span class="w"> </span>created
</code></pre></div>
<h3 id="confirm-operations">Confirm operations<a class="headerlink" href="#confirm-operations" title="Permanent link"> ¶</a></h3>
<p>Apply the test file to the cluster. The service should get an IP address from pool, reachable with a browser or curl call.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># testLB.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-server</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd:alpine</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-server-service</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</code></pre></div>
<p>Apply and confirm</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Apply the file</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>testLB.yaml

<span class="c1"># Get IP address assigned</span>
kubectl<span class="w"> </span>get<span class="w"> </span>svc

NAME<span class="w">                 </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">       </span>EXTERNAL-IP<span class="w">       </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">        </span>AGE
kubernetes<span class="w">           </span>ClusterIP<span class="w">      </span><span class="m">10</span>.96.0.1<span class="w">        </span>&lt;none&gt;<span class="w">            </span><span class="m">443</span>/TCP<span class="w">        </span>87m
web-server-service<span class="w">   </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.105.178.203<span class="w">   </span><span class="m">192</span>.168.163.151<span class="w">   </span><span class="m">80</span>:32671/TCP<span class="w">   </span>96s

<span class="c1"># Confirm with curl from outside the VM</span>
curl<span class="w"> </span><span class="m">192</span>.168.163.151
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It<span class="w"> </span>works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;

<span class="c1"># Confirm in a browser if desired at http://192.168.163.151</span>
</code></pre></div>
<h3 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Permanent link"> ¶</a></h3>
<p>Remove the application by running <code>kubectl delete -f testLB.yaml</code></p>
<h2 id="create-snapshot-k8smetal">Create snapshot 'k8sMetal'<a class="headerlink" href="#create-snapshot-k8smetal" title="Permanent link"> ¶</a></h2>
<p>Shutdown the VMs, and snapshot each one.  See the helper script in this repository located at <code>99-helper-scripts/manageCluster.sh</code> that can be used for automating things under VMware.</p>
<h2 id="rook-and-ceph">Rook and Ceph<a class="headerlink" href="#rook-and-ceph" title="Permanent link"> ¶</a></h2>
<p>Some Ping products require persistent storage through volumes, using a PVC/PV model.  In this section, you will install and configure Rook and Ceph to operate as a block storage option to support this need, including a default storage class.</p>
<h3 id="confirm-requirements">Confirm requirements<a class="headerlink" href="#confirm-requirements" title="Permanent link"> ¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Confirm no filesystem on second disk</span>
<span class="c1"># lsbkl -f should show no FSTYPE (empty), just the device name</span>
<span class="c1"># Run this command on each node</span>
lsblk<span class="w"> </span>-f<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>sdb
</code></pre></div>
<p>Configure the cluster to support the admission controller by installing cert-manager:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/jetstack/cert-manager/releases/download/v1.11.0/cert-manager.yaml
</code></pre></div>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link"> ¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Get the code</span>
git<span class="w"> </span>clone<span class="w"> </span>--single-branch<span class="w"> </span>--branch<span class="w"> </span>v1.10.12<span class="w"> </span>https://github.com/rook/rook.git

<span class="c1"># Navigate to the directory with the files we need</span>
<span class="nb">cd</span><span class="w"> </span>rook/deploy/examples

<span class="c1"># Install the Rook operator</span>
<span class="c1"># Apply the necessary files</span>
<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>crds.yaml<span class="w"> </span>-f<span class="w"> </span>common.yaml<span class="w"> </span>-f<span class="w"> </span>operator.yaml

<span class="c1"># Verify the rook-ceph-operator is in the `Running` state before proceeding</span>
<span class="c1"># Alternatively, use k9s to monitor</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>rook-ceph<span class="w"> </span>get<span class="w"> </span>pod

<span class="c1"># Use the production config (supports redundancy/replication of data)</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>cluster.yaml

<span class="c1"># Confirm</span>
<span class="c1"># Deploy will take several minutes.  Confirm all pods are running before continuing.  This example is for three nodes:</span>

kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>rook-ceph

NAME<span class="w">                                                     </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
csi-cephfsplugin-provisioner-68d67c47dd-87h6v<span class="w">            </span><span class="m">5</span>/5<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-cephfsplugin-provisioner-68d67c47dd-8l525<span class="w">            </span><span class="m">5</span>/5<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-cephfsplugin-px6dz<span class="w">                                   </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-cephfsplugin-qzn8p<span class="w">                                   </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-cephfsplugin-xlt6g<span class="w">                                   </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-rbdplugin-lchgj<span class="w">                                      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-rbdplugin-mhbrn<span class="w">                                      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-rbdplugin-provisioner-7686b584f5-mtbdb<span class="w">               </span><span class="m">5</span>/5<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-rbdplugin-provisioner-7686b584f5-vpkdb<span class="w">               </span><span class="m">5</span>/5<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
csi-rbdplugin-xgxpm<span class="w">                                      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m27s
rook-ceph-crashcollector-k8s126master-68f8544cf4-sztnp<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2m29s
rook-ceph-crashcollector-k8s126node1-576566657f-d8rzg<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>118s
rook-ceph-crashcollector-k8s126node2-68f88b6c4d-tfkh8<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2m
rook-ceph-mgr-a-6bd475b77b-fpv4m<span class="w">                         </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2m39s
rook-ceph-mgr-b-5b54874985-fvlmf<span class="w">                         </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2m38s
rook-ceph-mon-a-7b89d4576d-qkzcq<span class="w">                         </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>4m24s
rook-ceph-mon-b-7668864f8-bsrhp<span class="w">                          </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m53s
rook-ceph-mon-c-7cc896d469-hlchp<span class="w">                         </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>3m40s
rook-ceph-operator-659649f647-8c89d<span class="w">                      </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>46m
rook-ceph-osd-0-59d877889d-z5mvp<span class="w">                         </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2m
rook-ceph-osd-1-66558bd8bc-t4cck<span class="w">                         </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>117s
rook-ceph-osd-2-84886885f4-xnhcm<span class="w">                         </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>119s
rook-ceph-osd-prepare-k8s126master-4plhb<span class="w">                 </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m15s
rook-ceph-osd-prepare-k8s126node1-k5m9w<span class="w">                  </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m15s
rook-ceph-osd-prepare-k8s126node2-xxz7t<span class="w">                  </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m15s
</code></pre></div>
<h3 id="confirm-status-of-the-storage-system">Confirm status of the storage system<a class="headerlink" href="#confirm-status-of-the-storage-system" title="Permanent link"> ¶</a></h3>
<p>Deploy a toolbox pod for storage commands commands</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Deploy the pod</span>
kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>toolbox.yaml
</code></pre></div>
<p>To verify that the ceph cluster is in a healthy state, connect to the Rook toolbox pod with the <code>kubectl exec</code> command and run the <code>ceph status</code> command.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Access the pod to run commands</span>
<span class="c1"># You may have to press Enter to get a prompt</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>rook-ceph<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>deploy/rook-ceph-tools<span class="w"> </span>--<span class="w"> </span>bash

<span class="c1"># Overall status of the ceph cluster</span>
<span class="c1">## All mons should be in quorum</span>
<span class="c1">## A mgr should be active</span>
<span class="c1">## At least one OSD should be active</span>
ceph<span class="w"> </span>status

<span class="w">  </span>cluster:
<span class="w">    </span>id:<span class="w">     </span>184f1c82-4a0b-499a-80c6-44c6bf70cbc5
<span class="w">    </span>health:<span class="w"> </span>HEALTH_WARN
<span class="w">            </span><span class="m">1</span><span class="w"> </span>pool<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>have<span class="w"> </span>an<span class="w"> </span>application<span class="w"> </span>enabled

<span class="w">  </span>services:
<span class="w">    </span>mon:<span class="w"> </span><span class="m">3</span><span class="w"> </span>daemons,<span class="w"> </span>quorum<span class="w"> </span>a,b,c<span class="w"> </span><span class="o">(</span>age<span class="w"> </span>3m<span class="o">)</span><span class="w">          </span>&lt;--<span class="w"> </span>mons<span class="w"> </span><span class="k">in</span><span class="w"> </span>quorum
<span class="w">    </span>mgr:<span class="w"> </span>a<span class="o">(</span>active,<span class="w"> </span>since<span class="w"> </span>2m<span class="o">)</span>,<span class="w"> </span>standbys:<span class="w"> </span>b<span class="w">          </span>&lt;--<span class="w"> </span>active<span class="w"> </span>mgr
<span class="w">    </span>osd:<span class="w"> </span><span class="m">3</span><span class="w"> </span>osds:<span class="w"> </span><span class="m">3</span><span class="w"> </span>up<span class="w"> </span><span class="o">(</span>since<span class="w"> </span>3m<span class="o">)</span>,<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span>since<span class="w"> </span>3m<span class="o">)</span><span class="w">  </span>&lt;--<span class="w"> </span><span class="m">1</span><span class="w"> </span>or<span class="w"> </span>more<span class="w"> </span>OSD

<span class="w">  </span>data:
<span class="w">    </span>pools:<span class="w">   </span><span class="m">1</span><span class="w"> </span>pools,<span class="w"> </span><span class="m">1</span><span class="w"> </span>pgs
<span class="w">    </span>objects:<span class="w"> </span><span class="m">2</span><span class="w"> </span>objects,<span class="w"> </span><span class="m">449</span><span class="w"> </span>KiB
<span class="w">    </span>usage:<span class="w">   </span><span class="m">61</span><span class="w"> </span>MiB<span class="w"> </span>used,<span class="w"> </span><span class="m">180</span><span class="w"> </span>GiB<span class="w"> </span>/<span class="w"> </span><span class="m">180</span><span class="w"> </span>GiB<span class="w"> </span>avail
<span class="w">    </span>pgs:<span class="w">     </span><span class="m">1</span><span class="w"> </span>active+clean

<span class="c1"># Ceph object storage daemon (osd) status</span>
ceph<span class="w"> </span>osd<span class="w"> </span>status

ID<span class="w">  </span>HOST<span class="w">           </span>USED<span class="w">  </span>AVAIL<span class="w">  </span>WR<span class="w"> </span>OPS<span class="w">  </span>WR<span class="w"> </span>DATA<span class="w">  </span>RD<span class="w"> </span>OPS<span class="w">  </span>RD<span class="w"> </span>DATA<span class="w">  </span>STATE
<span class="w"> </span><span class="m">0</span><span class="w">  </span>k8s126node01<span class="w">  </span><span class="m">20</span>.4M<span class="w">  </span><span class="m">59</span>.9G<span class="w">      </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">       </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">   </span>exists,up
<span class="w"> </span><span class="m">1</span><span class="w">  </span>k8s126master<span class="w">  </span><span class="m">20</span>.4M<span class="w">  </span><span class="m">59</span>.9G<span class="w">      </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">       </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">   </span>exists,up
<span class="w"> </span><span class="m">2</span><span class="w">  </span>k8s126node02<span class="w">  </span><span class="m">20</span>.4M<span class="w">  </span><span class="m">59</span>.9G<span class="w">      </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">       </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">   </span>exists,up

<span class="c1"># Free disk available</span>
ceph<span class="w"> </span>df

---<span class="w"> </span>RAW<span class="w"> </span>STORAGE<span class="w"> </span>---
CLASS<span class="w">     </span>SIZE<span class="w">    </span>AVAIL<span class="w">    </span>USED<span class="w">  </span>RAW<span class="w"> </span>USED<span class="w">  </span>%RAW<span class="w"> </span>USED
hdd<span class="w">    </span><span class="m">180</span><span class="w"> </span>GiB<span class="w">  </span><span class="m">180</span><span class="w"> </span>GiB<span class="w">  </span><span class="m">61</span><span class="w"> </span>MiB<span class="w">    </span><span class="m">61</span><span class="w"> </span>MiB<span class="w">       </span><span class="m">0</span>.03
TOTAL<span class="w">  </span><span class="m">180</span><span class="w"> </span>GiB<span class="w">  </span><span class="m">180</span><span class="w"> </span>GiB<span class="w">  </span><span class="m">61</span><span class="w"> </span>MiB<span class="w">    </span><span class="m">61</span><span class="w"> </span>MiB<span class="w">       </span><span class="m">0</span>.03

---<span class="w"> </span>POOLS<span class="w"> </span>---
POOL<span class="w">  </span>ID<span class="w">  </span>PGS<span class="w">   </span>STORED<span class="w">  </span>OBJECTS<span class="w">     </span>USED<span class="w">  </span>%USED<span class="w">  </span>MAX<span class="w"> </span>AVAIL
.mgr<span class="w">   </span><span class="m">1</span><span class="w">    </span><span class="m">1</span><span class="w">  </span><span class="m">449</span><span class="w"> </span>KiB<span class="w">        </span><span class="m">2</span><span class="w">  </span><span class="m">1</span>.3<span class="w"> </span>MiB<span class="w">      </span><span class="m">0</span><span class="w">     </span><span class="m">57</span><span class="w"> </span>GiB

<span class="c1"># Reliable autonomic distributed object store (RADOS) view</span>
rados<span class="w"> </span>df

POOL_NAME<span class="w">     </span>USED<span class="w">  </span>OBJECTS<span class="w">  </span>CLONES<span class="w">  </span>COPIES<span class="w">  </span>MISSING_ON_PRIMARY<span class="w">  </span>UNFOUND<span class="w">  </span>DEGRADED<span class="w">  </span>RD_OPS<span class="w">      </span>RD<span class="w">  </span>WR_OPS<span class="w">       </span>WR<span class="w">  </span>USED<span class="w"> </span>COMPR<span class="w">  </span>UNDER<span class="w"> </span>COMPR
.mgr<span class="w">       </span><span class="m">1</span>.3<span class="w"> </span>MiB<span class="w">        </span><span class="m">2</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="m">6</span><span class="w">                   </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w">         </span><span class="m">0</span><span class="w">      </span><span class="m">96</span><span class="w">  </span><span class="m">82</span><span class="w"> </span>KiB<span class="w">     </span><span class="m">113</span><span class="w">  </span><span class="m">1</span>.3<span class="w"> </span>MiB<span class="w">         </span><span class="m">0</span><span class="w"> </span>B<span class="w">          </span><span class="m">0</span><span class="w"> </span>B

total_objects<span class="w">    </span><span class="m">2</span>
total_used<span class="w">       </span><span class="m">61</span><span class="w"> </span>MiB
total_avail<span class="w">      </span><span class="m">180</span><span class="w"> </span>GiB
total_space<span class="w">      </span><span class="m">180</span><span class="w"> </span>GiB

<span class="c1"># Exit the container shell</span>
<span class="nb">exit</span>

<span class="c1"># (optional) Remove the toolbox pod</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>toolbox.yaml
</code></pre></div>
<h3 id="create-storage-class">Create storage class<a class="headerlink" href="#create-storage-class" title="Permanent link"> ¶</a></h3>
<p>Apply the storage class YAML file to create the storage class</p>
<div class="highlight"><pre><span></span><code><span class="c1">#sc-ceph-block.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CephBlockPool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">failureDomain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<span class="w">  </span><span class="nt">replicated</span><span class="p">:</span>
<span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">   </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-block</span>
<span class="c1"># Change &quot;rook-ceph&quot; provisioner prefix to match the operator namespace if needed</span>
<span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph.rbd.csi.ceph.com</span>
<span class="nt">parameters</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># clusterID is the namespace where the rook cluster is running</span>
<span class="w">    </span><span class="nt">clusterID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<span class="w">    </span><span class="c1"># Ceph pool into which the RBD image shall be created</span>
<span class="w">    </span><span class="nt">pool</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>

<span class="w">    </span><span class="c1"># (optional) mapOptions is a comma-separated list of map options.</span>
<span class="w">    </span><span class="c1"># For krbd options refer</span>
<span class="w">    </span><span class="c1"># https://docs.ceph.com/docs/master/man/8/rbd/#kernel-rbd-krbd-options</span>
<span class="w">    </span><span class="c1"># For nbd options refer</span>
<span class="w">    </span><span class="c1"># https://docs.ceph.com/docs/master/man/8/rbd-nbd/#options</span>
<span class="w">    </span><span class="c1"># mapOptions: lock_on_read,queue_depth=1024</span>

<span class="w">    </span><span class="c1"># (optional) unmapOptions is a comma-separated list of unmap options.</span>
<span class="w">    </span><span class="c1"># For krbd options refer</span>
<span class="w">    </span><span class="c1"># https://docs.ceph.com/docs/master/man/8/rbd/#kernel-rbd-krbd-options</span>
<span class="w">    </span><span class="c1"># For nbd options refer</span>
<span class="w">    </span><span class="c1"># https://docs.ceph.com/docs/master/man/8/rbd-nbd/#options</span>
<span class="w">    </span><span class="c1"># unmapOptions: force</span>

<span class="w">    </span><span class="c1"># RBD image format. Defaults to &quot;2&quot;.</span>
<span class="w">    </span><span class="nt">imageFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>

<span class="w">    </span><span class="c1"># RBD image features</span>
<span class="w">    </span><span class="c1"># Available for imageFormat: &quot;2&quot;. Older releases of CSI RBD</span>
<span class="w">    </span><span class="c1"># support only the `layering` feature. The Linux kernel (KRBD) supports the</span>
<span class="w">    </span><span class="c1"># full complement of features as of 5.4</span>
<span class="w">    </span><span class="c1"># `layering` alone corresponds to Ceph&#39;s bitfield value of &quot;2&quot; ;</span>
<span class="w">    </span><span class="c1"># `layering` + `fast-diff` + `object-map` + `deep-flatten` + `exclusive-lock` together</span>
<span class="w">    </span><span class="c1"># correspond to Ceph&#39;s OR&#39;d bitfield value of &quot;63&quot;. Here we use</span>
<span class="w">    </span><span class="c1"># a symbolic, comma-separated format:</span>
<span class="w">    </span><span class="c1"># For 5.4 or later kernels:</span>
<span class="w">    </span><span class="c1">#imageFeatures: layering,fast-diff,object-map,deep-flatten,exclusive-lock</span>
<span class="w">    </span><span class="c1"># For 5.3 or earlier kernels:</span>
<span class="w">    </span><span class="nt">imageFeatures</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">layering</span>

<span class="w">    </span><span class="c1"># The secrets contain Ceph admin credentials.</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/provisioner-secret-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-provisioner</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/provisioner-secret-namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/controller-expand-secret-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-provisioner</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/controller-expand-secret-namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/node-stage-secret-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-node</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/node-stage-secret-namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>

<span class="w">    </span><span class="c1"># Specify the filesystem type of the volume. If not specified, csi-provisioner</span>
<span class="w">    </span><span class="c1"># will set default as `ext4`. Note that `xfs` is not recommended due to potential deadlock</span>
<span class="w">    </span><span class="c1"># in hyperconverged settings where the volume is mounted on the same node as the osds.</span>
<span class="w">    </span><span class="nt">csi.storage.k8s.io/fstype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>

<span class="c1"># Delete the rbd volume when a PVC is deleted</span>
<span class="nt">reclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>

<span class="c1"># Optional, if you want to add dynamic resize for PVC.</span>
<span class="c1"># For now only ext3, ext4, xfs resize support provided, like in Kubernetes itself.</span>
<span class="nt">allowVolumeExpansion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Run <code>kubectl create -f sc-ceph-block.yaml</code></p>
<p>Test with mysql and wordpress examples from Rook</p>
<div class="highlight"><pre><span></span><code><span class="c1"># If necessary, navigate to the examples folder</span>
<span class="nb">cd</span><span class="w"> </span>~/rook/deploy/examples

<span class="c1"># Create a MySQL/Wordpress deployment</span>
kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>mysql.yaml
kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>wordpress.yaml

<span class="c1"># Confirm you can see the PVCs created</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pvc

NAME<span class="w">             </span>STATUS<span class="w">   </span>VOLUME<span class="w">                                     </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">      </span>AGE
mysql-pv-claim<span class="w">   </span>Bound<span class="w">    </span>pvc-a3f95bfb-351e-4270-b9eb-5a18cb857f21<span class="w">   </span>20Gi<span class="w">       </span>RWO<span class="w">            </span>rook-ceph-block<span class="w">   </span>93s
wp-pv-claim<span class="w">      </span>Bound<span class="w">    </span>pvc-78b47636-4a6c-459e-a5b8-05df61007f94<span class="w">   </span>20Gi<span class="w">       </span>RWO<span class="w">            </span>rook-ceph-block<span class="w">   </span>92s

kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>wordpress

NAME<span class="w">              </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">     </span>EXTERNAL-IP<span class="w">       </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">        </span>AGE
wordpress<span class="w">         </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.97.225.93<span class="w">   </span><span class="m">192</span>.168.163.151<span class="w">   </span><span class="m">80</span>:32302/TCP<span class="w">   </span>36s

<span class="c1"># Access Wordpress in the browser. It should have an IP address from MetalLB (http://192.168.163.151)</span>
<span class="c1"># You may have to force a refresh of your browser.</span>
</code></pre></div>
<p>Set the storage class you created as the default (<code>storageclass.kubernetes.io/is-default-class=true</code>)</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Before</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>sc<span class="w"> </span>rook-ceph-block
Name:<span class="w">                  </span>rook-ceph-block
IsDefaultClass:<span class="w">        </span>No
Annotations:<span class="w">           </span>&lt;none&gt;
...

<span class="c1"># Alter annotation</span>
kubectl<span class="w"> </span>patch<span class="w"> </span>storageclass<span class="w"> </span>rook-ceph-block<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>

<span class="c1"># After</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>sc<span class="w"> </span>rook-ceph-block
Name:<span class="w">                  </span>rook-ceph-block
IsDefaultClass:<span class="w">        </span>Yes
Annotations:<span class="w">           </span>&lt;none&gt;
...
</code></pre></div>
<p>Cleanup the deployment</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>wordpress.yaml
kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>mysql.yaml
kubectl<span class="w"> </span>delete<span class="w"> </span>pvc/mysql-pv-claim<span class="w"> </span>pvc/wp-pv-claim
</code></pre></div>
<h2 id="snapshot-k8smetalrook">Snapshot 'k8sMetalRook'<a class="headerlink" href="#snapshot-k8smetalrook" title="Permanent link"> ¶</a></h2>
<p>Shutdown the VMs, and snapshot each one.  See the helper script in this repository located at <code>99-helper-scripts/manageCluster.sh</code> that can be used for automating things under VMware.</p>
<h2 id="ingress-controller-and-istio">Ingress controller and Istio<a class="headerlink" href="#ingress-controller-and-istio" title="Permanent link"> ¶</a></h2>
<p>This section is optional.  If you are on a system with fewer resources than recommended, you can skip this part.</p>
<h3 id="ingress-nginx">Ingress Nginx<a class="headerlink" href="#ingress-nginx" title="Permanent link"> ¶</a></h3>
<p>Installation</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>upgrade<span class="w"> </span>--install<span class="w"> </span>ingress-nginx<span class="w"> </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--repo<span class="w"> </span>https://kubernetes.github.io/ingress-nginx<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>ingress-nginx<span class="w"> </span>--create-namespace
</code></pre></div>
<p>After installation completes, you should have the Nginx controller running in the ingress-nginx namespace, and a load-balancer attached service for the ingress</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List the pod</span>
kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-n<span class="w"> </span>ingress-nginx
NAME<span class="w">                                        </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
ingress-nginx-controller-65dc77f88f-nqnc6<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>7m1s

<span class="c1"># Examine the service</span>
<span class="c1"># Note the external IP from the MetalLB pool</span>
kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ingress-nginx
NAME<span class="w">                                 </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">       </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">                      </span>AGE
ingress-nginx-controller<span class="w">             </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.98.47.72<span class="w">     </span><span class="m">192</span>.168.163.151<span class="w">   </span><span class="m">80</span>:30056/TCP,443:31316/TCP<span class="w">   </span>7m36s
ingress-nginx-controller-admission<span class="w">   </span>ClusterIP<span class="w">      </span><span class="m">10</span>.96.230.188<span class="w">   </span>&lt;none&gt;<span class="w">            </span><span class="m">443</span>/TCP<span class="w">                      </span>7m36s
</code></pre></div>
<h3 id="istio">Istio<a class="headerlink" href="#istio" title="Permanent link"> ¶</a></h3>
<p>Installation will use the demo profile; this will add the ingress and egress gateways and size the Envoy sidecar smaller.</p>
<h4 id="prerequisites_1">Prerequisites<a class="headerlink" href="#prerequisites_1" title="Permanent link"> ¶</a></h4>
<p>In order to install Istio, you will need the <code>istioctl</code> utility.  On the Mac, you can use <strong>brew</strong> to install this application, or you can download the archive for your platform from the <a href="https://github.com/istio/istio/releases/tag/1.17.1">release page</a>.  You will need this archive to get the profile and add-on software in either case. Download the latest version (1.17.1 at the time of this writing). On the system used to develop this guide, the <strong><em>istioctl</em></strong> binary was installed using brew but the one contained in the archive can be used as an alternative. The instructions on installation are <a href="https://istio.io/latest/docs/setup/getting-started/">here</a>.</p>
<h4 id="installation_1">Installation<a class="headerlink" href="#installation_1" title="Permanent link"> ¶</a></h4>
<p>Extract the archive to a known location on your filesystem.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Downloads directory is assumed.</span>
<span class="nb">cd</span><span class="w"> </span>~/Downloads

<span class="c1"># Extract the archive</span>
tar<span class="w"> </span>xvzf<span class="w"> </span>istio-1.17.1-osx.tar.gz

<span class="c1"># Navigate to the profile directory and install the demo profile</span>
<span class="nb">cd</span><span class="w"> </span>istio-1.17.1/manifests/profiles/
istioctl<span class="w"> </span>install<span class="w"> </span>-f<span class="w"> </span>demo.yaml

This<span class="w"> </span>will<span class="w"> </span>install<span class="w"> </span>the<span class="w"> </span>Istio<span class="w"> </span><span class="m">1</span>.17.1<span class="w"> </span>default<span class="w"> </span>profile<span class="w"> </span>with<span class="w"> </span><span class="o">[</span><span class="s2">&quot;Istio core&quot;</span><span class="w"> </span><span class="s2">&quot;Istiod&quot;</span><span class="w"> </span><span class="s2">&quot;Ingress gateways&quot;</span><span class="w"> </span><span class="s2">&quot;Egress gateways&quot;</span><span class="o">]</span><span class="w"> </span>components<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>cluster.<span class="w"> </span>Proceed?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span>y
✔<span class="w"> </span>Istio<span class="w"> </span>core<span class="w"> </span>installed
✔<span class="w"> </span>Istiod<span class="w"> </span>installed
✔<span class="w"> </span>Ingress<span class="w"> </span>gateways<span class="w"> </span>installed
✔<span class="w"> </span>Egress<span class="w"> </span>gateways<span class="w"> </span>installed
✔<span class="w"> </span>Installation<span class="w"> </span><span class="nb">complete</span>
Making<span class="w"> </span>this<span class="w"> </span>installation<span class="w"> </span>the<span class="w"> </span>default<span class="w"> </span><span class="k">for</span><span class="w"> </span>injection<span class="w"> </span>and<span class="w"> </span>validation.

Thank<span class="w"> </span>you<span class="w"> </span><span class="k">for</span><span class="w"> </span>installing<span class="w"> </span>Istio<span class="w"> </span><span class="m">1</span>.17.<span class="w">  </span>Please<span class="w"> </span>take<span class="w"> </span>a<span class="w"> </span>few<span class="w"> </span>minutes<span class="w"> </span>to<span class="w"> </span>tell<span class="w"> </span>us<span class="w"> </span>about<span class="w"> </span>your<span class="w"> </span>install/upgrade<span class="w"> </span>experience!<span class="w">  </span>https://forms.gle/hMHGiwZHPU7UQRWe9
</code></pre></div>
<h4 id="add-ons-optional">Add ons (optional)<a class="headerlink" href="#add-ons-optional" title="Permanent link"> ¶</a></h4>
<p>The add-ons are the Kiali UI (for Istio), Jaeger, Grafana and Prometheus. The Kubernetes yaml files are included with each release of Istio and are specific to that release:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Navigate to the root of the extracted archive</span>
<span class="nb">cd</span><span class="w"> </span>../..

<span class="c1"># Apply the files to install the products</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>samples/addons
</code></pre></div>
<h3 id="configure-optional-applications-for-access">Configure Optional Applications for Access<a class="headerlink" href="#configure-optional-applications-for-access" title="Permanent link"> ¶</a></h3>
<p>With the load balancer in place, you can configure the services for the Istio add-ons to receive an IP address.  Edit the service for each of Grafana, Kiali, Jaeger (tracing service) and Prometheus to use a LoadBalancer instead of a ClusterIP.  When you are done, each should have an address assigned from MetalLB:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>istio-system<span class="w"> </span>svc

NAME<span class="w">                   </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">       </span>EXTERNAL-IP<span class="w">       </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">                                                                      </span>AGE
grafana<span class="w">                </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.111.62.240<span class="w">    </span><span class="m">192</span>.168.163.155<span class="w">   </span><span class="m">3000</span>:30319/TCP<span class="w">                                                               </span>25m
istio-egressgateway<span class="w">    </span>ClusterIP<span class="w">      </span><span class="m">10</span>.96.6.225<span class="w">      </span>&lt;none&gt;<span class="w">            </span><span class="m">80</span>/TCP,443/TCP<span class="w">                                                               </span>27m
istio-ingressgateway<span class="w">   </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.103.138.190<span class="w">   </span><span class="m">192</span>.168.163.152<span class="w">   </span><span class="m">15021</span>:32732/TCP,80:30065/TCP,443:30886/TCP,31400:30599/TCP,15443:30732/TCP<span class="w">   </span>27m
istiod<span class="w">                 </span>ClusterIP<span class="w">      </span><span class="m">10</span>.97.52.234<span class="w">     </span>&lt;none&gt;<span class="w">            </span><span class="m">15010</span>/TCP,15012/TCP,443/TCP,15014/TCP<span class="w">                                        </span>27m
jaeger-collector<span class="w">       </span>ClusterIP<span class="w">      </span><span class="m">10</span>.100.61.0<span class="w">      </span>&lt;none&gt;<span class="w">            </span><span class="m">14268</span>/TCP,14250/TCP,9411/TCP<span class="w">                                                 </span>25m
kiali<span class="w">                  </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.106.88.19<span class="w">     </span><span class="m">192</span>.168.163.153<span class="w">   </span><span class="m">20001</span>:31277/TCP,9090:30502/TCP<span class="w">                                               </span>25m
prometheus<span class="w">             </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.101.166.132<span class="w">   </span><span class="m">192</span>.168.163.154<span class="w">   </span><span class="m">9090</span>:32112/TCP<span class="w">                                                               </span>25m
tracing<span class="w">                </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.96.226.87<span class="w">     </span><span class="m">192</span>.168.163.156<span class="w">   </span><span class="m">80</span>:31510/TCP,16685:32309/TCP<span class="w">                                                 </span>25m
zipkin<span class="w">                 </span>ClusterIP<span class="w">      </span><span class="m">10</span>.109.64.92<span class="w">     </span>&lt;none&gt;<span class="w">            </span><span class="m">9411</span>/TCP<span class="w">                                                                     </span>25m
</code></pre></div>
<p>In the example above, the following URLs would be used to access the user interfaces (UIs) of each product:</p>
<ul>
<li>Kiali:  <a href="http://192.168.163.153:20001/">http://192.168.163.153:20001/</a></li>
<li>Grafana: <a href="http://192.168.163.155:3000/">http://192.168.163.155:3000/</a></li>
<li>Prometheus: <a href="http://192.168.163.154:9090/">http://192.168.163.154:9090/</a></li>
<li>Jaeger: <a href="http://192.168.163.156">http://192.168.163.156</a></li>
</ul>
<h2 id="snapshot-k8scomplete">Snapshot 'k8sComplete'<a class="headerlink" href="#snapshot-k8scomplete" title="Permanent link"> ¶</a></h2>
<p>Shutdown the VMs, and snapshot each one.  See the helper script in this repository located at <code>99-helper-scripts/manageCluster.sh</code> that can be used for automating things under VMware.</p>
<h2 id="resources-references">Resources &amp; References<a class="headerlink" href="#resources-references" title="Permanent link"> ¶</a></h2>
<p>This guide was built on the work of others. As with many how-to documents, we have contributed our skills and knowledge to pull everything together and fill in the gaps that were experienced.  However, we want to acknowledge at least some of the many sources where we found inspiration, guidance, fixes for errors, and sanity when a step was missed. Not shown here are dozens of places where we went in exploring different options for pieces we did not use or install in the end. <em>the Ping BRASS team</em></p>
<ul>
<li><a href="https://computingforgeeks.com/deploy-metallb-load-balancer-on-kubernetes/">How to Deploy MetalLB on Kubernetes - ComputingForGeeks</a></li>
<li><a href="https://www.cyberciti.biz/faq/howto-regenerate-openssh-host-keys">How To: Ubuntu / Debian Linux Regenerate OpenSSH Host Keys - nixCraft</a></li>
<li><a href="https://www.rook.io/docs/rook/v1.10/Storage-Configuration/Block-Storage-RBD/block-storage/#advanced-example-erasure-coded-block-storage">Block Storage Overview - Rook Ceph Documentation</a></li>
<li><a href="https://www.rook.io/docs/rook/v1.10/Troubleshooting/ceph-toolbox/#interactive-toolbox">Toolbox - Rook Ceph Documentation</a></li>
<li><a href="https://www.rook.io/docs/rook/v1.10/Getting-Started/quickstart">Quickstart - Rook Ceph Documentation</a></li>
<li><a href="https://www.itzgeek.com/how-tos/linux/ubuntu-how-tos/install-kubernetes-on-ubuntu-22-04.html">How to Install Kubernetes on Ubuntu 22.04 / Ubuntu 20.04 | ITzGeek</a></li>
<li><a href="https://blog.kubesimplify.com/kubernetes-126">Kubernetes 1.26 - The electrifying release setup - KubeSimplify</a></li>
<li><a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">Containerd Github</a></li>
<li><a href="https://github.com/etcd-io/etcd/issues/13670">etcd-io Github issue #13670</a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © Copyright 2023 Ping Identity
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "instant", "navigation.top"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51198bba.min.js"></script>
      
    
  </body>
</html>